"use strict";(self.webpackChunkizanami_documentation=self.webpackChunkizanami_documentation||[]).push([[4150],{3574:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>s});var i=a(5893),l=a(1151);const t={title:"APIs"},o=void 0,r={id:"configs/api",title:"APIs",description:"Data model",source:"@site/v1/10-configs/02-api.mdx",sourceDirName:"10-configs",slug:"/configs/api",permalink:"/izanami/v1/configs/api",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"APIs"},sidebar:"defaultSidebar",previous:{title:"The UI",permalink:"/izanami/v1/configs/ui"},next:{title:"Spring config",permalink:"/izanami/v1/configs/springconfig"}},c={},s=[{value:"Data model",id:"data-model",level:2},{value:"CRUD API",id:"crud-api",level:2},{value:"List all",id:"list-all",level:3},{value:"Create a config",id:"create-a-config",level:3},{value:"Get a config",id:"get-a-config",level:3},{value:"Update a config",id:"update-a-config",level:3},{value:"Patch a config",id:"patch-a-config",level:3},{value:"Delete a config",id:"delete-a-config",level:3},{value:"Tree API",id:"tree-api",level:2},{value:"Download and Upload",id:"download-and-upload",level:2},{value:"Download",id:"download",level:3},{value:"Upload",id:"upload",level:3}];function d(n){const e={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,l.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"data-model",children:"Data model"}),"\n",(0,i.jsx)(e.p,{children:"A config is just an String id and a json value :"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "id": "my:id",\n  "value": "A value"\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"crud-api",children:"CRUD API"}),"\n",(0,i.jsx)(e.p,{children:"Configs expose a classic CRUD REST api :"}),"\n",(0,i.jsx)(e.h3,{id:"list-all",children:"List all"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -X GET \\\n  'http://localhost:9000/api/configs?pattern=*&page=1&pageSize=15' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Izanami-Client-Id: xxxx' \\\n  -H 'Izanami-Client-Secret: xxxx' | jq\n"})}),"\n",(0,i.jsx)(e.p,{children:"Will respond with a 200 status code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "results": [\n    {\n      "id": "ragnar:lodbrok:email",\n      "value": { "email": "ragnar.lodbrok@gmail.com" }\n    }\n  ],\n  "metadata": {\n    "page": 1,\n    "pageSize": 15,\n    "count": 1,\n    "nbPages": 1\n  }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"The query params are optional and the value used in this example are the default one."}),"\n",(0,i.jsx)(e.h3,{id:"create-a-config",children:"Create a config"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -XPOST \\\n    'http://localhost:9000/api/configs' \\\n    -H 'Content-Type: application/json' \\\n    -H 'Izanami-Client-Id: xxxx' \\\n    -H 'Izanami-Client-Secret: xxxx' \\\n    -d '{ \"id\": \"ragnar:lodbrok:city\", \"value\": {\"city\": \"Kattegat\"} }' | jq\n"})}),"\n",(0,i.jsx)(e.p,{children:"Will respond with a 201 status code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "id": "ragnar:lodbrok:city",\n  "value": { "city": "Kattegat" }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"get-a-config",children:"Get a config"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -X GET \\\n  'http://localhost:9000/api/configs/ragnar:lodbrok:city' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Izanami-Client-Id: xxxx' \\\n  -H 'Izanami-Client-Secret: xxxx' | jq\n"})}),"\n",(0,i.jsx)(e.p,{children:"Will respond with a 200 status code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "id": "ragnar:lodbrok:city",\n  "value": {\n    "city": "Kattegat"\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"update-a-config",children:"Update a config"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -X PUT \\\n  'http://localhost:9000/api/configs/ragnar:lodbrok:city' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Izanami-Client-Id: xxxx' \\\n  -H 'Izanami-Client-Secret: xxxx' \\\n  -d '{ \"id\": \"ragnar:lodbrok:city\", \"value\": {\"city\": \"Northumbria\"} }' | jq\n"})}),"\n",(0,i.jsx)(e.p,{children:"Will respond with a 200 status code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "id": "ragnar:lodbrok:city",\n  "value": {\n    "city": "Northumbria"\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"patch-a-config",children:"Patch a config"}),"\n",(0,i.jsx)(e.p,{children:"Partial updates can be done using json patch :"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'curl -X PATCH \\\n  \'http://localhost:9000/api/configs/ragnar:lodbrok:city\' \\\n  -H \'Content-Type: application/json\' \\\n  -H \'Izanami-Client-Id: xxxx\' \\\n  -H \'Izanami-Client-Secret: xxxx\' \\\n  -d \'[{"op": "replace", "path": "/value", "value": {"city": "Northumbria"} }]\' | jq\n'})}),"\n",(0,i.jsx)(e.p,{children:"Will respond with a 200 status code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "id": "ragnar:lodbrok:city",\n  "value": {\n    "city": "Northumbria"\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"delete-a-config",children:"Delete a config"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -X DELETE \\\n  'http://localhost:9000/api/configs/ragnar:lodbrok:city' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Izanami-Client-Id: xxxx' \\\n  -H 'Izanami-Client-Secret: xxxx' | jq\n"})}),"\n",(0,i.jsx)(e.p,{children:"Will respond with a 200 status code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "id": "ragnar:lodbrok:city",\n  "value": {\n    "city": "Northumbria"\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"tree-api",children:"Tree API"}),"\n",(0,i.jsx)(e.p,{children:"The tree api format the response as tree.\nBe careful using this API because the results are not paged so be sure to use an appropriate pattern :"}),"\n",(0,i.jsx)(e.p,{children:"For example if we create this datas :"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'curl -XPOST \\\n    \'http://localhost:9000/api/configs\' \\\n    -H \'Content-Type: application/json\' \\\n    -H \'Izanami-Client-Id: xxxx\' \\\n    -H \'Izanami-Client-Secret: xxxx\' \\\n    -d \'{ "id": "ragnar:lodbrok:city", "value": "{\\"city\\": \\"Kattegat\\"}" }\' | jq\n\ncurl -XPOST \\\n    \'http://localhost:9000/api/configs\' \\\n    -H \'Content-Type: application/json\' \\\n    -H \'Izanami-Client-Id: xxxx\' \\\n    -H \'Izanami-Client-Secret: xxxx\' \\\n    -d \'{ "id": "ragnar:lodbrok:email", "value": "\\"ragnar.lodbrok@gmail.com\\"" }\' | jq\n'})}),"\n",(0,i.jsx)(e.p,{children:"And then use the tree APIs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -X GET \\\n  'http://localhost:9000/api/tree/configs?pattern=ragnar:*' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Izanami-Client-Id: xxxx' \\\n  -H 'Izanami-Client-Secret: xxxx' | jq\n"})}),"\n",(0,i.jsx)(e.p,{children:"We will get the following response:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "ragnar": {\n    "lodbrok": {\n      "city": {\n        "city": "Kattegat"\n      },\n      "email": {\n        "email": "ragnar.lodbrok@gmail.com"\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["As you can see, the keys are split with ",(0,i.jsx)(e.code,{children:":"})," and the json and the json values are expended into a tree representation."]}),"\n",(0,i.jsx)(e.h2,{id:"download-and-upload",children:"Download and Upload"}),"\n",(0,i.jsxs)(e.p,{children:["Download and upload is done using the ",(0,i.jsx)(e.a,{href:"http://ndjson.org/",children:"nd-json"})," format."]}),"\n",(0,i.jsx)(e.h3,{id:"download",children:"Download"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -X GET \\\n  'http://localhost:9000/api/configs.ndjson' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Izanami-Client-Id: xxxx' \\\n  -H 'Izanami-Client-Secret: xxxx' | jq\n"})}),"\n",(0,i.jsxs)(e.p,{children:["Will return each item separated by a ",(0,i.jsx)(e.code,{children:"\\n"}),"."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-nd-json",children:'{\n  "id": "ragnar:lodbrok:city",\n  "value": {"city": "Northumbria"}\n}\n{\n  "id": "ragnar:lodbrok:email",\n  "value": {"email": "ragnar.lodbrok@gmail.com"}\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"upload",children:"Upload"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'curl -X POST \\\n  \'http://localhost:9000/api/configs.ndjson\' \\\n  -H \'Content-Type: application/nd-json\' \\\n  -H \'Izanami-Client-Id: xxxx\' \\\n  -H \'Izanami-Client-Secret: xxxx\' \\\n  -d \'{ "id": "ragnar:lodbrok:city", "value": {"city": "Northumbria"}" }\n      {"id": "ragnar:lodbrok:email", "value": {"email": "ragnar.lodbrok@gmail.com"}}\' \\\n   | jq\n'})}),"\n",(0,i.jsx)(e.p,{children:"Will return"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "success": 2,\n  "errors": {\n    "errors": [],\n    "fieldErrors": {}\n  }\n}\n'})})]})}function p(n={}){const{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},1151:(n,e,a)=>{a.d(e,{Z:()=>r,a:()=>o});var i=a(7294);const l={},t=i.createContext(l);function o(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:o(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);