"use strict";(self.webpackChunkizanami_documentation=self.webpackChunkizanami_documentation||[]).push([[7581],{425:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var r=t(5893),i=t(1151);t(1361);const o={title:"OAuth2 rights"},a="Map provider roles to rights",s={id:"guides/oidc-configuration",title:"OAuth2 rights",description:"Izanami allow to setup an OAuth2 provider.",source:"@site/docs/04-guides/20-oidc-configuration.mdx",sourceDirName:"04-guides",slug:"/guides/oidc-configuration",permalink:"/izanami/docs/guides/oidc-configuration",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{title:"OAuth2 rights"},sidebar:"tutorialSidebar",previous:{title:"Stale feature detection",permalink:"/izanami/docs/guides/stales-features"},next:{title:"Clients",permalink:"/izanami/docs/clients/"}},l={},d=[{value:"Role",id:"role",level:2},{value:"Right format",id:"right-format",level:2},{value:"Default rights",id:"default-rights",level:2},{value:"Role merge",id:"role-merge",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Izanami allow to setup an OAuth2 provider."}),"\n",(0,r.jsxs)(n.p,{children:["Configuratioin of provider is ",(0,r.jsx)(n.a,{href:"https://maif.github.io/izanami/docs/guides/configuration#openid",children:"documented here"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"This page focuses on attributing rights to user coming from external auth provider."}),"\n",(0,r.jsx)(n.h1,{id:"map-provider-roles-to-rights",children:"Map provider roles to rights"}),"\n",(0,r.jsxs)(n.p,{children:["To attribute default rights to external users, you'll have to define ",(0,r.jsx)(n.code,{children:"app.openid.right-by-roles"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"This property is a map, whose keys are roles, and value are rights that should be given to external users with these roles."}),"\n",(0,r.jsx)(n.h2,{id:"role",children:"Role"}),"\n",(0,r.jsxs)(n.p,{children:["Role are provided by OAuth2 provider. You must specify claim that contains roles in token sent by OAuth2 provider in ",(0,r.jsx)(n.code,{children:"app.openid.role-claim"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Role claim must contain either a string containing a single role, or a json array containing a list of roles"}),"\n",(0,r.jsx)(n.h2,{id:"right-format",children:"Right format"}),"\n",(0,r.jsx)(n.p,{children:"Each role is associated with a set of rights."}),"\n",(0,r.jsx)(n.p,{children:"Here is a complete set of rights:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "admin": <true|false>, // Wether user is global admin\n  "tenants": {\n    "my-tenant": {\n      "level": "<read|write|admin>", // Right level for tenant "my-tenant"\n      "default-project-right": "<read|update|write|admin>", // default project right for "my-tenant"\n      "default-key-right": "<read|write|admin>", // default key right for "my-tenant"\n      "default-webhook-right": "<read|write|admin>", // default webhook right for "my-tenant"\n      "projects": {\n        "my-project": "<read|update|write|admin>", // Specific right level for project "my-project"\n        "another-project": "<read|update|write|admin>" // Specific right level for project "another-project"\n      },\n      "keys": {\n        "my-key": "<read|write|admin>" // Specific right level for key "my-key"\n      },\n      "webhooks": {\n        "my-hook": "<read|write|admin>" // Specific right level for webhook "my-hook"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["To know more about rights and what they allow, see ",(0,r.jsx)(n.a,{href:"../usages/rights",children:"this page"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"default-rights",children:"Default rights"}),"\n",(0,r.jsxs)(n.p,{children:["To specify default rights for any oidc user, you'll need to define rights for a role ",(0,r.jsx)(n.code,{children:'""'}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "": {\n    "tenants": {\n      "my-tenant": {\n        "level": "read",\n        "default-project-right": "read"\n      }\n    }\n  },\n  "another-role": {\n    // ...\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"role-merge",children:"Role merge"}),"\n",(0,r.jsx)(n.p,{children:"When a user has multiple role, or when he has one role and default rights, Izanami merges rights from different roles and default rights to keep only higher rights."}),"\n",(0,r.jsxs)(n.p,{children:["For instance, with the following configuration, a user with roles ",(0,r.jsx)(n.code,{children:"foo"})," and ",(0,r.jsx)(n.code,{children:"bar"})," will have:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"global admin rights"}),"\n",(0,r.jsxs)(n.li,{children:["admin right on ",(0,r.jsx)(n.code,{children:"my-tenant"})]}),"\n",(0,r.jsxs)(n.li,{children:["default project right of ",(0,r.jsx)(n.code,{children:"update"})," for ",(0,r.jsx)(n.code,{children:"my-tenant"})]}),"\n",(0,r.jsxs)(n.li,{children:["default key right of ",(0,r.jsx)(n.code,{children:"read"})," for ",(0,r.jsx)(n.code,{children:"my-tenant"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "": {\n    "tenants": {\n      "my-tenant": {\n        "level": "read",\n        "default-project-right": "read",\n        "default-key-right": "read"\n      }\n    }\n  },\n  "foo": {\n    "admin": true,\n    "my-tenant": {\n      "level": "write",\n      "default-project-right": "update"\n    }\n  },\n  "bar": {\n    "my-tenant": {\n      "level": "admin",\n      "default-project-right": "read"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"rights-modes",children:"Rights modes"}),"\n",(0,r.jsx)(n.p,{children:"Role synchronisation between external authentication provider and Izanami can be done using two different strategies:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"initial"}),": this strategy assigns rights to external user ",(0,r.jsx)(n.strong,{children:"at first connection"}),", user rights are not updated thereafter.\nIn this mode, external user rights can be updated directly from Izanami as for a normal user."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"supervised"}),": as for ",(0,r.jsx)(n.code,{children:"internal"})," strategy, this one assigns rights at first connection.\nThis mode also \"reset\" rights at every login, allowing update of roles or right by role to be taken into account.\nIn this mode, external use rights can't be updated from Izanami, to update one user rights you'll have to add / remove him roles\nin external authentication provider or to update ",(0,r.jsx)(n.code,{children:"right-by-roles"})," configuration."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},1361:(e,n,t)=>{t.d(n,{j:()=>a});const r={description__trivia:"description__trivia_yesz"};var i=t(4625),o=t(5893);function a(e){let{children:n}=e;return(0,o.jsxs)("div",{className:r.description__trivia,children:[(0,o.jsx)("img",{src:i.Z}),(0,o.jsx)("div",{children:n})]})}},4625:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/izanami_compressed-659337582c1667d92966e42fa1bfea3f.webp"},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>a});var r=t(7294);const i={},o=r.createContext(i);function a(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);