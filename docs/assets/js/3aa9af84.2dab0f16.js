"use strict";(self.webpackChunkizanami_documentation=self.webpackChunkizanami_documentation||[]).push([[773],{8116:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=s(5893),r=s(1151);const i={title:"Developing Izanami"},a=void 0,o={id:"dev/index",title:"Developing Izanami",description:"Here are some tips to help you get started with Izanami contribution.",source:"@site/docs/06-dev/index.mdx",sourceDirName:"06-dev",slug:"/dev/",permalink:"/izanami/docs/dev/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Developing Izanami"},sidebar:"tutorialSidebar",previous:{title:"Server Sent Events",permalink:"/izanami/docs/clients/java/sse"}},l={},d=[{value:"Tools",id:"tools",level:2},{value:"Clone remote repository",id:"clone-remote-repository",level:2},{value:"Install deps",id:"install-deps",level:2},{value:"Running project",id:"running-project",level:2},{value:"Running tests",id:"running-tests",level:2},{value:"Backend tests",id:"backend-tests",level:3},{value:"Experimental direct test execution",id:"experimental-direct-test-execution",level:4},{value:"Frontend tests",id:"frontend-tests",level:3},{value:"Packaging",id:"packaging",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Here are some tips to help you get started with Izanami contribution."}),"\n",(0,t.jsx)(n.h2,{id:"tools",children:"Tools"}),"\n",(0,t.jsx)(n.p,{children:"Here is what you'll need"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"git"}),"\n",(0,t.jsx)(n.li,{children:"SBT > 1.9.7"}),"\n",(0,t.jsx)(n.li,{children:"JDK >= 21"}),"\n",(0,t.jsx)(n.li,{children:"Node > 20"}),"\n",(0,t.jsx)(n.li,{children:"Docker / Colima / whatever allows you to run docker-compose"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"clone-remote-repository",children:"Clone remote repository"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"git clone git@github.com:MAIF/izanami.git\ncd izanami\n"})}),"\n",(0,t.jsx)(n.h2,{id:"install-deps",children:"Install deps"}),"\n",(0,t.jsx)(n.p,{children:"For backend"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sbt compile\n"})}),"\n",(0,t.jsx)(n.p,{children:"For frontend"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"cd izanami-frontend\nnpm install\n"})}),"\n",(0,t.jsx)(n.h2,{id:"running-project",children:"Running project"}),"\n",(0,t.jsxs)(n.p,{children:["First let's start some containers, ",(0,t.jsx)(n.code,{children:"docker-compose.yml"})," contains everything that may be needed by Izanami (mock SMTP server, WASMO, simple OIDC provider, postgres database, ...).\nYou may delete some of these elements to reduce consumed resources, however you need to keep the Postgres database."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# In root directory\ndocker-compose up\n"})}),"\n",(0,t.jsx)(n.p,{children:"Now let's start the backend"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# Opening 5005 port allows to plug in Izanami for debug\nsbt -jvm-debug 5005\n# You may add -Dapp.sessions.TTL=604800 to have longer login sessions\n~run -Dconfig.resource=dev.conf\n"})}),"\n",(0,t.jsx)(n.p,{children:"And finally let's start frontend application"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"cd izanami-frontend\nnpm run dev\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After eveyrhing is started, browse to ",(0,t.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"})," (login form may take some time to respon since compilation is started on first backend request)."]}),"\n",(0,t.jsx)(n.h2,{id:"running-tests",children:"Running tests"}),"\n",(0,t.jsx)(n.h3,{id:"backend-tests",children:"Backend tests"}),"\n",(0,t.jsx)(n.p,{children:"To run backend tests, you will need to start Izanami and associated containers independently."}),"\n",(0,t.jsx)(n.p,{children:"To do so, just start the backend and the docker containers with the above commands."}),"\n",(0,t.jsx)(n.p,{children:"Once backend and containers are started, just run"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sbt test\n"})}),"\n",(0,t.jsx)(n.h4,{id:"experimental-direct-test-execution",children:"Experimental direct test execution"}),"\n",(0,t.jsx)(n.p,{children:"Alternatively, you can run one test suite directly (without Izanami and containers running). The suite will start everything for you, however this is way slower than above method and still highly experimental."}),"\n",(0,t.jsx)(n.p,{children:"If you're using Colima instead of docker, this method may require the following env variables to be set :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"DOCKER_HOST=unix://${HOME}/.colima/default/docker.sock;\nRYUK_CONTAINER_PRIVILEGED=true;\nTESTCONTAINERS_DOCKER_SOCKET_OVERRIDE=/var/run/docker.sock\n"})}),"\n",(0,t.jsx)(n.h3,{id:"frontend-tests",children:"Frontend tests"}),"\n",(0,t.jsx)(n.p,{children:"As for backend tests, you'll need backend and docker containers started to run frontend tests."}),"\n",(0,t.jsx)(n.p,{children:"You'll also need to start your frontend on localhost:3000 (using above commands)."}),"\n",(0,t.jsx)(n.p,{children:"Once everything is running, just run"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npm test\n"})}),"\n",(0,t.jsx)(n.p,{children:"You may need to let playwright install browsers before executing tests."}),"\n",(0,t.jsx)(n.h2,{id:"packaging",children:"Packaging"}),"\n",(0,t.jsx)(n.p,{children:"To package frontend :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"cd izanami-frontend\nnpm run build\n"})}),"\n",(0,t.jsx)(n.p,{children:"To package backend (make sure to package frontend first) :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'sbt "set test in assembly := {}" clean assembly\n'})}),"\n",(0,t.jsx)(n.p,{children:"To start generated jar"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"java -Dconfig.resource=dev.conf -jar ./target/scala-2.13/izanami.jar\n"})}),"\n",(0,t.jsx)(n.p,{children:"To build docker image (after packaging frontend and backends)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker build -t izanami .\n"})}),"\n",(0,t.jsx)(n.p,{children:"To test docker image"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker run --env IZANAMI_PG_URI=postgresql://postgres:postgres@host.docker.internal:5432/postgres -p 9000:9000 izanami\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>a});var t=s(7294);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);