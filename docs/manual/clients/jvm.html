<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Java & Scala · Izanami</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='Izanami'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Izanami
</a>
<div class="version-number">
099c22aff28f60f84e3f44a158aeebe51af2ef7f*
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="../quickstart.html" class="page">Quick start</a></li>
  <li><a href="../about.html" class="page">About Izanami</a></li>
  <li><a href="../philosophy.html" class="page">Philosophy</a></li>
  <li><a href="../features.html" class="page">What&rsquo;s in the box</a></li>
  <li><a href="../architecture/index.html" class="page">Architecture</a></li>
  <li><a href="../getizanami/index.html" class="page">Get Izanami</a>
  <ul>
    <li><a href="../getizanami/binaries.html" class="page">From Binaries</a></li>
    <li><a href="../getizanami/docker.html" class="page">From Docker</a></li>
    <li><a href="../getizanami/fromsources.html" class="page">From sources</a></li>
  </ul></li>
  <li><a href="../settings/index.html" class="page">Settings</a>
  <ul>
    <li><a href="../settings/database.html" class="page">Choose the database</a></li>
    <li><a href="../settings/settings.html" class="page">All the settings</a></li>
  </ul></li>
  <li><a href="../ui.html" class="page">UI usage</a></li>
  <li><a href="../api.html" class="page">APIs usage</a></li>
  <li><a href="../configs/index.html" class="page">Shared Configs</a>
  <ul>
    <li><a href="../configs/ui.html" class="page">The UI</a></li>
    <li><a href="../configs/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../features/index.html" class="page">Feature flipping</a>
  <ul>
    <li><a href="../features/ui.html" class="page">The UI</a></li>
    <li><a href="../features/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../experiments/index.html" class="page">A/B testing</a>
  <ul>
    <li><a href="../experiments/ui.html" class="page">The UI</a></li>
    <li><a href="../experiments/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../events.html" class="page">Listen to events</a></li>
  <li><a href="../clients/index.html" class="page">Clients</a>
  <ul>
    <li><a href="../clients/jvm.html" class="active page">Java &amp; Scala</a></li>
    <li><a href="../clients/react.html" class="page">React client</a></li>
    <li><a href="../clients/node.html" class="page">Node js client</a></li>
  </ul></li>
  <li><a href="../developers/index.html" class="page">For Developers</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Izanami</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Izanami
</a>
<div class="version-number">
099c22aff28f60f84e3f44a158aeebe51af2ef7f*
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="../quickstart.html" class="page">Quick start</a></li>
  <li><a href="../about.html" class="page">About Izanami</a></li>
  <li><a href="../philosophy.html" class="page">Philosophy</a></li>
  <li><a href="../features.html" class="page">What&rsquo;s in the box</a></li>
  <li><a href="../architecture/index.html" class="page">Architecture</a></li>
  <li><a href="../getizanami/index.html" class="page">Get Izanami</a>
  <ul>
    <li><a href="../getizanami/binaries.html" class="page">From Binaries</a></li>
    <li><a href="../getizanami/docker.html" class="page">From Docker</a></li>
    <li><a href="../getizanami/fromsources.html" class="page">From sources</a></li>
  </ul></li>
  <li><a href="../settings/index.html" class="page">Settings</a>
  <ul>
    <li><a href="../settings/database.html" class="page">Choose the database</a></li>
    <li><a href="../settings/settings.html" class="page">All the settings</a></li>
  </ul></li>
  <li><a href="../ui.html" class="page">UI usage</a></li>
  <li><a href="../api.html" class="page">APIs usage</a></li>
  <li><a href="../configs/index.html" class="page">Shared Configs</a>
  <ul>
    <li><a href="../configs/ui.html" class="page">The UI</a></li>
    <li><a href="../configs/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../features/index.html" class="page">Feature flipping</a>
  <ul>
    <li><a href="../features/ui.html" class="page">The UI</a></li>
    <li><a href="../features/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../experiments/index.html" class="page">A/B testing</a>
  <ul>
    <li><a href="../experiments/ui.html" class="page">The UI</a></li>
    <li><a href="../experiments/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../events.html" class="page">Listen to events</a></li>
  <li><a href="../clients/index.html" class="page">Clients</a>
  <ul>
    <li><a href="../clients/jvm.html" class="active page">Java &amp; Scala</a></li>
    <li><a href="../clients/react.html" class="page">React client</a></li>
    <li><a href="../clients/node.html" class="page">Node js client</a></li>
  </ul></li>
  <li><a href="../developers/index.html" class="page">For Developers</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Izanami</a></li>
  <li><a href="../clients/index.html">Clients</a></li>
  <li>Java &amp; Scala</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#java-scala" name="java-scala" class="anchor"><span class="anchor-link"></span></a>Java &amp; Scala</h1>
<div class="toc ">
<ul>
  <li><a href="../clients/jvm.html#setup-the-izanami-client" class="header">Setup the Izanami client</a></li>
  <li><a href="../clients/jvm.html#configs-client" class="header">Configs client</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-client" class="header">Setup the client</a>
    <ul>
      <li><a href="../clients/jvm.html#the-smart-cache-strategy" class="header">The smart cache strategy</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#client-usage" class="header">Client usage</a>
    <ul>
      <li><a href="../clients/jvm.html#get-configs-for-a-pattern" class="header">Get configs for a pattern</a></li>
      <li><a href="../clients/jvm.html#get-one-config" class="header">Get one config</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../clients/jvm.html#features-client" class="header">Features client</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-client" class="header">Setup the client</a>
    <ul>
      <li><a href="../clients/jvm.html#the-smart-cache-strategy" class="header">The smart cache strategy</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#client-usage" class="header">Client usage</a>
    <ul>
      <li><a href="../clients/jvm.html#list-features" class="header">List features</a></li>
      <li><a href="../clients/jvm.html#check-feature" class="header">Check feature</a></li>
      <li><a href="../clients/jvm.html#conditional-code-on-feature" class="header">Conditional code on feature</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../clients/jvm.html#experiments-client" class="header">Experiments client</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-client" class="header">Setup the client</a></li>
    <li><a href="../clients/jvm.html#variants" class="header">Variants</a>
    <ul>
      <li><a href="../clients/jvm.html#get-a-variant-for-a-client" class="header">Get a variant for a client</a></li>
      <li><a href="../clients/jvm.html#mark-variant-displayed" class="header">Mark variant displayed</a></li>
      <li><a href="../clients/jvm.html#mark-variant-won" class="header">Mark variant won</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#work-with-experiment" class="header">Work with experiment</a>
    <ul>
      <li><a href="../clients/jvm.html#get-the-experiment" class="header">Get the experiment</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#experiment-tree" class="header">Experiment tree</a></li>
  </ul></li>
  <li><a href="../clients/jvm.html#exposing-izanami-with-a-proxy" class="header">Exposing izanami with a Proxy</a></li>
</ul>
</div>
<p>It&rsquo;s simple to build your client using the APIs. If you&rsquo;re application is built on jvm you can also use the built-in Izanami client. </p>
<p>This client offer nice strategies for better performances. </p>
<p>Add the following dependency to your project </p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "fr.maif" %% "izanami-client" % "099c22aff28f60f84e3f44a158aeebe51af2ef7f-SNAPSHOT"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;fr.maif&lt;/groupId&gt;
  &lt;artifactId&gt;izanami-client_2.12&lt;/artifactId&gt;
  &lt;version&gt;099c22aff28f60f84e3f44a158aeebe51af2ef7f-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'fr.maif', name: 'izanami-client_2.12', version: '099c22aff28f60f84e3f44a158aeebe51af2ef7f-SNAPSHOT'
}</code></pre></dd></dl>
<p>The client can be used in java or scala. There is two distinct dsl. Be sure to import the correct one : </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">import izanami.*;
import izanami.javadsl.*;
</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">import izanami._
import izanami.scaladsl._
</code></pre></dd>
</dl>
<p>Izanami client is built with </p>
<ul>
  <li><a href="https://www.scala-lang.org/">Scala</a>: As programming language</li>
  <li><a href="https://akka.io/docs/">Akka</a>: to handle global state, scheduler &hellip;</li>
  <li><a href="https://doc.akka.io/docs/akka-http/current/scala/http/index.html">Akka http</a>: for http request, sse &hellip;</li>
</ul>
<p>The scaladsl rely on :</p>
<ul>
  <li><a href="https://github.com/playframework/play-json">play json</a>: for json handling</li>
</ul>
<p>The javadsl rely on : </p>
<ul>
  <li><a href="http://www.vavr.io/">vavr</a>: For functional structures like future, either, option &hellip;</li>
  <li><a href="https://github.com/mathieuancelin/json-lib-javaslang">play json java</a>: For json handling</li>
</ul>
<h2><a href="#setup-the-izanami-client" name="setup-the-izanami-client" class="anchor"><span class="anchor-link"></span></a>Setup the Izanami client</h2>
<p>The first thing to do is to create a client. The client own the shared http client between config client, feature client and the experiment client.</p>
<p>You need to create a single client for all your application. </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">izanamiClient = IzanamiClient.client(
        system,
        ClientConfig.create(&quot;http://localhost:8089&quot;)
                .withClientId(&quot;xxxx&quot;)
                .withClientIdHeaderName(&quot;Another-Client-Id-Header&quot;)
                .withClientSecret(&quot;xxxx&quot;)
                .withClientSecretHeaderName(&quot;Another-Client-Secret-Header&quot;)
                .sseBackend()
                .withDispatcher(&quot;izanami-example.blocking-io-dispatcher&quot;)
                .withPageSize(50)
                .withZoneId(ZoneId.of(&quot;Europe/Paris&quot;))
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">implicit val system = ActorSystem(
  &quot;izanami-client&quot;,
  ConfigFactory.parseString(&quot;&quot;&quot;
    izanami-example.blocking-io-dispatcher {
      type = Dispatcher
      executor = &quot;thread-pool-executor&quot;
      thread-pool-executor {
        fixed-pool-size = 32
      }
      throughput = 1
    }
  &quot;&quot;&quot;)
)

val client = IzanamiClient(
  ClientConfig(
    host = &quot;http://localhost:9000&quot;,
    clientId = Some(&quot;xxxx&quot;),
    clientIdHeaderName = &quot;Another-Client-Id-Header&quot;,
    clientSecret = Some(&quot;xxxx&quot;),
    clientSecretHeaderName = &quot;Another-Client-Id-Header&quot;,
    backend = SseBackend,
    pageSize = 50,
    zoneId = ZoneId.of(&quot;Europe/Paris&quot;),
    dispatcher = &quot;izanami-example.blocking-io-dispatcher&quot;
  )
)</code></pre></dd>
</dl>
<table>
  <thead>
    <tr>
      <th>Field </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>clientId</code> </td>
      <td>The client id to access izanami APIs see <a href="../ui.html#manage-api-keys">Manage APIs keys</a> </td>
    </tr>
    <tr>
      <td><code>clientSecretIdName</code> </td>
      <td>A custom header for the client id </td>
    </tr>
    <tr>
      <td><code>clientSecret</code> </td>
      <td>The client secret to access izanami APIs see <a href="../ui.html#manage-api-keys">Manage APIs keys</a> </td>
    </tr>
    <tr>
      <td><code>clientSecretHeaderName</code> </td>
      <td>A custom header for the client secret </td>
    </tr>
    <tr>
      <td><code>sseBackend</code> </td>
      <td>Enable sse to get events from the server </td>
    </tr>
    <tr>
      <td><code>dispatcher</code> </td>
      <td>Reference a dispatcher to manage thread pool </td>
    </tr>
    <tr>
      <td><code>pageSize</code> </td>
      <td>Change the size of the pages when fetching from the server </td>
    </tr>
    <tr>
      <td><code>zoneId</code> </td>
      <td>Zone Id to handle date </td>
    </tr>
  </tbody>
</table>
<h2><a href="#configs-client" name="configs-client" class="anchor"><span class="anchor-link"></span></a>Configs client</h2>
<p>The config client is used to access the shared config in Izanami. To understand how configs work, just visit this </p>
<h3><a href="#setup-the-client" name="setup-the-client" class="anchor"><span class="anchor-link"></span></a>Setup the client</h3>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigClient configClient = izanamiClient.configClient(
        Strategies.fetchStrategy(),
        Configs.configs(
                Config.config(&quot;my:config&quot;, Json.obj(
                        $(&quot;value&quot;, &quot;Fallback value&quot;)
                ))
        )
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configClient = client.configClient(
  strategy = Strategies.fetchStrategy(),
  fallback = Configs(
    &quot;test2&quot; -&gt; Json.obj(&quot;value&quot; -&gt; 2)
  )
)</code></pre></dd>
</dl>
<p>When you set up a client you have to choose a strategy : </p>
<table>
  <thead>
    <tr>
      <th>Strategy </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fetch </td>
      <td>Call izanami for each request </td>
    </tr>
    <tr>
      <td>Fetch with cache </td>
      <td>Keep response in cache </td>
    </tr>
    <tr>
      <td>Smart cache with polling </td>
      <td>Keep data in memory and poll izanami to refresh the cache asynchronously. </td>
    </tr>
    <tr>
      <td>Smart cache with sse </td>
      <td>Keep data in memory and refresh the cache with the events from the izanami server. </td>
    </tr>
  </tbody>
</table>
<h4><a href="#the-smart-cache-strategy" name="the-smart-cache-strategy" class="anchor"><span class="anchor-link"></span></a>The smart cache strategy</h4>
<p>When you choose the smart cache, you have to provide patterns : </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigClient configClient = izanamiClient.configClient(
        Strategies.smartCacheWithPollingStrategy(
                FiniteDuration.create(20, TimeUnit.SECONDS),
                &quot;my:configs:*&quot;, &quot;other:pattern&quot;
        ),
        Configs.configs(
                Config.config(&quot;my:config&quot;, Json.obj(
                        $(&quot;value&quot;, &quot;Fallback value&quot;)
                ))
        )
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configClient = client.configClient(
  strategy = CacheWithPollingStrategy(
    patterns = Seq(&quot;*&quot;),
    pollingInterval = 3.second
  ),
  fallback = fallback
)</code></pre></dd>
</dl>
<p>The client will cache all the configs matching this patterns. </p>
<ul>
  <li>With a poll strategy, the client will request the server to get change so you have to set a delay.</li>
  <li>With a SSE strategy, the client will listen events from the server to refresh the cache.</li>
</ul><div class="callout warning "><div class="callout-title">Warning</div>
<p>There is no TTL using this strategy so you have to choose the right patterns to be sure that all datas fit in memory. </p></div>
<h3><a href="#client-usage" name="client-usage" class="anchor"><span class="anchor-link"></span></a>Client usage</h3>
<h4><a href="#get-configs-for-a-pattern" name="get-configs-for-a-pattern" class="anchor"><span class="anchor-link"></span></a>Get configs for a pattern</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Configs&gt; futureConfigs = configClient.configs(&quot;my:*&quot;);
futureConfigs.onSuccess( (Configs configs) -&gt; {
    JsValue config = configs.config(&quot;my:config&quot;);
    System.out.println(config.field(&quot;value&quot;).asString());
});</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configs: Future[Configs] = izanamiClient.configs(&quot;*&quot;)
configs.onComplete {
  case Success(c) =&gt; println(c)
  case Failure(e) =&gt; e.printStackTrace()
}</code></pre></dd>
</dl>
<h4><a href="#get-one-config" name="get-one-config" class="anchor"><span class="anchor-link"></span></a>Get one config</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;JsValue&gt; futureConfig = configClient.config(&quot;my:config&quot;);
futureConfig.onSuccess( (JsValue config) -&gt; {
    System.out.println(config.field(&quot;value&quot;).asString());
});</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureConfig: Future[JsValue] = izanamiClient.config(&quot;test&quot;)
futureConfig.onComplete {
  case Success(c) =&gt; println(c)
  case Failure(e) =&gt; e.printStackTrace()
}</code></pre></dd>
</dl>
<h2><a href="#features-client" name="features-client" class="anchor"><span class="anchor-link"></span></a>Features client</h2>
<p>To understand how features work, just visit this </p>
<h3><a href="#setup-the-client" name="setup-the-client" class="anchor"><span class="anchor-link"></span></a>Setup the client</h3>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">FeatureClient featureClient = izanamiClient.featureClient(
        Strategies.fetchStrategy(),
        Features.features(
                Features.feature(&quot;my:feature&quot;, false)
        )
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val featureClient = client.featureClient(
  strategy = Strategies.fetchStrategy(),
  fallback = Features(
    DefaultFeature(&quot;test2&quot;, true)
  )
)</code></pre></dd>
</dl>
<p>When you set up a client you have to choose a strategy : </p>
<table>
  <thead>
    <tr>
      <th>Strategy </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fetch </td>
      <td>Call izanami for each request </td>
    </tr>
    <tr>
      <td>Fetch with cache </td>
      <td>Keep response in cache </td>
    </tr>
    <tr>
      <td>Smart cache with polling </td>
      <td>Keep data in memory and poll izanami to refresh the cache asynchronously. The features that need a context are not cached because it can needs a huge amount of memory </td>
    </tr>
    <tr>
      <td>Smart cache with sse </td>
      <td>Keep data in memory and refresh the cache with the events from the izanami server. The features that need a context are not cached because it can needs a huge amount of memory </td>
    </tr>
  </tbody>
</table>
<h4><a href="#the-smart-cache-strategy" name="the-smart-cache-strategy" class="anchor"><span class="anchor-link"></span></a>The smart cache strategy</h4>
<p>When you choose the smart cache, you have to provide patterns : </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">FeatureClient featureClient = izanamiClient.featureClient(
        Strategies.smartCacheWithSseStrategy(
        &quot;my:features:*&quot;, &quot;other:pattern&quot;
        ),
        Features.features(
                Features.feature(&quot;my:feature&quot;, false)
        )
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val featureClient = client.featureClient(
  strategy = CacheWithPollingStrategy(
    patterns = Seq(&quot;*&quot;),
    pollingInterval = 3.second
  ),
  fallback = Features(fallback: _*)
)</code></pre></dd>
</dl>
<p>The client will cache all the configs matching this patterns. </p>
<ul>
  <li>With a poll strategy, the client will request the server to get change so you have to set a delay.</li>
  <li>With a SSE strategy, the client will listen events from the server to refresh the cache.</li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>The feature that need a context to be evaluated are not cached. The cache is used only for simple features or feature with release date. </p></div><div class="callout warning "><div class="callout-title">Warning</div>
<p>There is no TTL using this strategy so you have to choose the right patterns to be sure that all datas fit in memory. </p></div>
<h3><a href="#client-usage" name="client-usage" class="anchor"><span class="anchor-link"></span></a>Client usage</h3>
<h4><a href="#list-features" name="list-features" class="anchor"><span class="anchor-link"></span></a>List features</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Features&gt; futureFeatures = featureClient.features(&quot;my:feature:*&quot;);

futureFeatures.onSuccess(features -&gt; {
    boolean active = features.isActive(&quot;my:feature:test&quot;);
    if (active) {
        System.out.println(&quot;Feature my:feature:test is active&quot;);
    } else {
        System.out.println(&quot;Feature my:feature:test is active&quot;);
    }
    JsObject tree = features.tree();
    System.out.println(&quot;Tree is &quot; + Json.prettyPrint(tree));
});</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureFeatures: Future[Features] = featureClient.features(&quot;*&quot;)
futureFeatures.onComplete {
  case Success(features) =&gt;
    val active: Boolean = features.isActive(&quot;test&quot;)
    if (active)
      println(s&quot;Feature test is active&quot;)
    else
      println(s&quot;Feature test is not active&quot;)

    val tree: JsObject = features.tree()
    println(s&quot;All features: ${Json.prettyPrint(tree)}&quot;)

  case Failure(e) =&gt;
    e.printStackTrace()
}</code></pre></dd>
</dl>
<h4><a href="#check-feature" name="check-feature" class="anchor"><span class="anchor-link"></span></a>Check feature</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Boolean&gt; futureCheck = featureClient.checkFeature(&quot;my:feature&quot;);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureCheck: Future[Boolean] = featureClient.checkFeature(&quot;test&quot;)</code></pre></dd>
</dl>
<p>If the feature needs a context to be evaluated: </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Boolean&gt; futureCheckContext = featureClient.checkFeature(&quot;my:feature&quot;, Json.obj(
        $(&quot;context&quot;, true)
));</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val context                           = Json.obj(&quot;context&quot; -&gt; true)
val checkWithContext: Future[Boolean] = featureClient.checkFeature(&quot;test&quot;, context)</code></pre></dd>
</dl>
<h4><a href="#conditional-code-on-feature" name="conditional-code-on-feature" class="anchor"><span class="anchor-link"></span></a>Conditional code on feature</h4>
<p>This execute a code and return a value if a feature is active: </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;String&gt; conditonal = featureClient.featureOrElse(&quot;my:feature&quot;,
        () -&gt; &quot;Feature is active&quot;,
        () -&gt; &quot;Feature is not active&quot;
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val conditonal: Future[String] = featureClient.featureOrElse(&quot;test&quot;) {
  &quot;Feature is active&quot;
} {
  &quot;Feature is not active&quot;
}</code></pre></dd>
</dl>
<p>Or with a context </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;String&gt; conditonalContext = featureClient.featureOrElse(
        &quot;my:feature&quot;,
        Json.obj($(&quot;context&quot;, true)),
        () -&gt; &quot;Feature is active&quot;,
        () -&gt; &quot;Feature is not active&quot;
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val conditonalWithContext: Future[String] = featureClient.featureOrElse(&quot;test&quot;, context) {
  &quot;Feature is active&quot;
} {
  &quot;Feature is not active&quot;
}</code></pre></dd>
</dl>
<h2><a href="#experiments-client" name="experiments-client" class="anchor"><span class="anchor-link"></span></a>Experiments client</h2>
<p>To understand how experiments work, just visit this  </p>
<h3><a href="#setup-the-client" name="setup-the-client" class="anchor"><span class="anchor-link"></span></a>Setup the client</h3>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ExperimentsClient experimentsClient = izanamiClient.experimentClient(Strategies.fetchStrategy());</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val experimentClient = IzanamiClient(ClientConfig(ctx.host))
  .experimentClient(Strategies.fetchStrategy())</code></pre></dd>
</dl>
<p>For experiments, there is only two strategies available : fetch or dev.</p>
<h3><a href="#variants" name="variants" class="anchor"><span class="anchor-link"></span></a>Variants</h3>
<h4><a href="#get-a-variant-for-a-client" name="get-a-variant-for-a-client" class="anchor"><span class="anchor-link"></span></a>Get a variant for a client</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Option&lt;Variant&gt;&gt; futureVariant = experimentsClient.getVariantFor(&quot;my:experiment&quot;, &quot;clientId&quot;);
futureVariant.onSuccess(mayBeVariant -&gt;
        System.out.println(mayBeVariant)
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val mayBeFutureVariant: Future[Option[Variant]] = experimentClient.getVariantFor(&quot;test&quot;, &quot;client1&quot;)
mayBeFutureVariant.onComplete {
  case Success(mayBeVariant) =&gt; println(mayBeVariant)
  case Failure(e)            =&gt; e.printStackTrace()
}</code></pre></dd>
</dl>
<h4><a href="#mark-variant-displayed" name="mark-variant-displayed" class="anchor"><span class="anchor-link"></span></a>Mark variant displayed</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;ExperimentVariantDisplayed&gt; futureDisplayed = experimentsClient.markVariantDisplayed(&quot;my:experiment&quot;, &quot;clientId&quot;);
futureDisplayed.onSuccess(event -&gt;
        System.out.println(event)
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureDisplayed: Future[ExperimentVariantDisplayed] =
  experimentClient.markVariantDisplayed(&quot;test&quot;, &quot;client1&quot;)
futureDisplayed.onComplete {
  case Success(event) =&gt; println(event)
  case Failure(e)     =&gt; e.printStackTrace()
}</code></pre></dd>
</dl>
<h4><a href="#mark-variant-won" name="mark-variant-won" class="anchor"><span class="anchor-link"></span></a>Mark variant won</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;ExperimentVariantWon&gt; futureWon = experimentsClient.markVariantWon(&quot;my:experiment&quot;, &quot;clientId&quot;);
futureWon.onSuccess(event -&gt;
        System.out.println(event)
);</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureWon: Future[ExperimentVariantWon] = experimentClient.markVariantWon(&quot;test&quot;, &quot;client1&quot;)
futureWon.onComplete {
  case Success(event) =&gt; println(event)
  case Failure(e)     =&gt; e.printStackTrace()
}</code></pre></dd>
</dl>
<h3><a href="#work-with-experiment" name="work-with-experiment" class="anchor"><span class="anchor-link"></span></a>Work with experiment</h3>
<h4><a href="#get-the-experiment" name="get-the-experiment" class="anchor"><span class="anchor-link"></span></a>Get the experiment</h4>
<h3><a href="#experiment-tree" name="experiment-tree" class="anchor"><span class="anchor-link"></span></a>Experiment tree</h3>
<h2><a href="#exposing-izanami-with-a-proxy" name="exposing-izanami-with-a-proxy" class="anchor"><span class="anchor-link"></span></a>Exposing izanami with a Proxy</h2>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/MAIF/izanami/tree/master/izanami-documentation/src/main/paradox/clients/jvm.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../clients/react.html">React client</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../clients/jvm.html#java-scala" class="header">Java &amp; Scala</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-izanami-client" class="header">Setup the Izanami client</a></li>
    <li><a href="../clients/jvm.html#configs-client" class="header">Configs client</a></li>
    <li><a href="../clients/jvm.html#features-client" class="header">Features client</a></li>
    <li><a href="../clients/jvm.html#experiments-client" class="header">Experiments client</a></li>
    <li><a href="../clients/jvm.html#exposing-izanami-with-a-proxy" class="header">Exposing izanami with a Proxy</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2017</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
