<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Java & Scala · Izanami</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='Izanami'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Izanami
</a>
<div class="version-number">
1.4.5*
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="../quickstart.html" class="page">Quick start</a></li>
  <li><a href="../about.html" class="page">About Izanami</a></li>
  <li><a href="../philosophy.html" class="page">Philosophy</a></li>
  <li><a href="../features.html" class="page">What&rsquo;s in the box</a></li>
  <li><a href="../architecture/index.html" class="page">Architecture</a></li>
  <li><a href="../getizanami/index.html" class="page">Get Izanami</a>
  <ul>
    <li><a href="../getizanami/binaries.html" class="page">From Binaries</a></li>
    <li><a href="../getizanami/docker.html" class="page">From Docker</a></li>
    <li><a href="../getizanami/fromsources.html" class="page">From sources</a></li>
  </ul></li>
  <li><a href="../settings/index.html" class="page">Settings</a>
  <ul>
    <li><a href="../settings/database.html" class="page">Choose the database</a></li>
    <li><a href="../settings/settings.html" class="page">All the settings</a></li>
  </ul></li>
  <li><a href="../ui.html" class="page">UI usage</a></li>
  <li><a href="../api.html" class="page">APIs usage</a></li>
  <li><a href="../configs/index.html" class="page">Shared Configs</a>
  <ul>
    <li><a href="../configs/ui.html" class="page">The UI</a></li>
    <li><a href="../configs/api.html" class="page">APIs</a></li>
    <li><a href="../configs/springconfig.html" class="page">Spring config</a></li>
  </ul></li>
  <li><a href="../features/index.html" class="page">Feature flipping</a>
  <ul>
    <li><a href="../features/ui.html" class="page">The UI</a></li>
    <li><a href="../features/scripts.html" class="page">Scripts</a></li>
    <li><a href="../features/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../experiments/index.html" class="page">A/B testing</a>
  <ul>
    <li><a href="../experiments/ui.html" class="page">The UI</a></li>
    <li><a href="../experiments/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../keys.html" class="page">Key definition and best practices</a></li>
  <li><a href="../events.html" class="page">Listen to events</a></li>
  <li><a href="../clients/index.html" class="page">Clients</a>
  <ul>
    <li><a href="../clients/jvm.html" class="active page">Java &amp; Scala</a></li>
    <li><a href="../clients/react.html" class="page">React client</a></li>
    <li><a href="../clients/angular.html" class="page">Angular client</a></li>
    <li><a href="../clients/node.html" class="page">Node js client</a></li>
    <li><a href="../clients/cli.html" class="page">CLI</a></li>
  </ul></li>
  <li><a href="../tutorials/index.html" class="page">Tutorials</a>
  <ul>
    <li><a href="../tutorials/spring.html" class="page">Spring / React tutorial</a></li>
  </ul></li>
  <li><a href="../performances.html" class="page">Performances</a></li>
  <li><a href="../developers/index.html" class="page">For Developers</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title-wrapper">
<div class="title-logo"></div>
<div class="title"><a href="../index.html">Izanami</a></div>
</div>
<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Izanami
</a>
<div class="version-number">
1.4.5*
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="../quickstart.html" class="page">Quick start</a></li>
  <li><a href="../about.html" class="page">About Izanami</a></li>
  <li><a href="../philosophy.html" class="page">Philosophy</a></li>
  <li><a href="../features.html" class="page">What&rsquo;s in the box</a></li>
  <li><a href="../architecture/index.html" class="page">Architecture</a></li>
  <li><a href="../getizanami/index.html" class="page">Get Izanami</a>
  <ul>
    <li><a href="../getizanami/binaries.html" class="page">From Binaries</a></li>
    <li><a href="../getizanami/docker.html" class="page">From Docker</a></li>
    <li><a href="../getizanami/fromsources.html" class="page">From sources</a></li>
  </ul></li>
  <li><a href="../settings/index.html" class="page">Settings</a>
  <ul>
    <li><a href="../settings/database.html" class="page">Choose the database</a></li>
    <li><a href="../settings/settings.html" class="page">All the settings</a></li>
  </ul></li>
  <li><a href="../ui.html" class="page">UI usage</a></li>
  <li><a href="../api.html" class="page">APIs usage</a></li>
  <li><a href="../configs/index.html" class="page">Shared Configs</a>
  <ul>
    <li><a href="../configs/ui.html" class="page">The UI</a></li>
    <li><a href="../configs/api.html" class="page">APIs</a></li>
    <li><a href="../configs/springconfig.html" class="page">Spring config</a></li>
  </ul></li>
  <li><a href="../features/index.html" class="page">Feature flipping</a>
  <ul>
    <li><a href="../features/ui.html" class="page">The UI</a></li>
    <li><a href="../features/scripts.html" class="page">Scripts</a></li>
    <li><a href="../features/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../experiments/index.html" class="page">A/B testing</a>
  <ul>
    <li><a href="../experiments/ui.html" class="page">The UI</a></li>
    <li><a href="../experiments/api.html" class="page">APIs</a></li>
  </ul></li>
  <li><a href="../keys.html" class="page">Key definition and best practices</a></li>
  <li><a href="../events.html" class="page">Listen to events</a></li>
  <li><a href="../clients/index.html" class="page">Clients</a>
  <ul>
    <li><a href="../clients/jvm.html" class="active page">Java &amp; Scala</a></li>
    <li><a href="../clients/react.html" class="page">React client</a></li>
    <li><a href="../clients/angular.html" class="page">Angular client</a></li>
    <li><a href="../clients/node.html" class="page">Node js client</a></li>
    <li><a href="../clients/cli.html" class="page">CLI</a></li>
  </ul></li>
  <li><a href="../tutorials/index.html" class="page">Tutorials</a>
  <ul>
    <li><a href="../tutorials/spring.html" class="page">Spring / React tutorial</a></li>
  </ul></li>
  <li><a href="../performances.html" class="page">Performances</a></li>
  <li><a href="../developers/index.html" class="page">For Developers</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Izanami</a></li>
  <li><a href="../clients/index.html">Clients</a></li>
  <li>Java &amp; Scala</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#java-scala" name="java-scala" class="anchor"><span class="anchor-link"></span></a>Java &amp; Scala</h1>
<div class="toc ">
<ul>
  <li><a href="../clients/jvm.html#setup-the-izanami-client" class="header">Setup the Izanami client</a></li>
  <li><a href="../clients/jvm.html#configs-client" class="header">Configs client</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-client" class="header">Setup the client</a>
    <ul>
      <li><a href="../clients/jvm.html#the-fetch-strategy" class="header">The fetch strategy</a></li>
      <li><a href="../clients/jvm.html#the-fetch-with-cache-strategy" class="header">The fetch with cache strategy</a></li>
      <li><a href="../clients/jvm.html#the-smart-cache-strategy" class="header">The smart cache strategy</a></li>
      <li><a href="../clients/jvm.html#handling-errors" class="header">Handling errors</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#client-usage" class="header">Client usage</a>
    <ul>
      <li><a href="../clients/jvm.html#get-configs-for-a-pattern" class="header">Get configs for a pattern</a></li>
      <li><a href="../clients/jvm.html#get-one-config" class="header">Get one config</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../clients/jvm.html#features-client" class="header">Features client</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-client" class="header">Setup the client</a>
    <ul>
      <li><a href="../clients/jvm.html#the-fetch-strategy" class="header">The fetch strategy</a></li>
      <li><a href="../clients/jvm.html#the-fetch-with-cache-strategy" class="header">The fetch with cache strategy</a></li>
      <li><a href="../clients/jvm.html#the-smart-cache-strategy" class="header">The smart cache strategy</a></li>
      <li><a href="../clients/jvm.html#handling-errors" class="header">Handling errors</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#client-usage" class="header">Client usage</a>
    <ul>
      <li><a href="../clients/jvm.html#list-features" class="header">List features</a></li>
      <li><a href="../clients/jvm.html#check-feature" class="header">Check feature</a></li>
      <li><a href="../clients/jvm.html#conditional-code-on-feature" class="header">Conditional code on feature</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../clients/jvm.html#experiments-client" class="header">Experiments client</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-client" class="header">Setup the client</a></li>
    <li><a href="../clients/jvm.html#variants" class="header">Variants</a>
    <ul>
      <li><a href="../clients/jvm.html#get-a-variant-for-a-client" class="header">Get a variant for a client</a></li>
      <li><a href="../clients/jvm.html#mark-variant-displayed" class="header">Mark variant displayed</a></li>
      <li><a href="../clients/jvm.html#mark-variant-won" class="header">Mark variant won</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#work-with-experiment" class="header">Work with experiment</a>
    <ul>
      <li><a href="../clients/jvm.html#get-the-experiment" class="header">Get the experiment</a></li>
    </ul></li>
    <li><a href="../clients/jvm.html#experiment-tree" class="header">Experiment tree</a></li>
  </ul></li>
  <li><a href="../clients/jvm.html#exposing-izanami-with-a-proxy" class="header">Exposing izanami with a Proxy</a></li>
</ul>
</div>
<p>It&rsquo;s simple to build your client using the APIs. If you&rsquo;re application is built on jvm you can also use the built-in Izanami client. </p>
<p>This client offer nice strategies for better performances. </p>
<p>You need to add repository</p>
<dl>
  <dt>Graddle</dt>
  <dd>
  <pre class="prettyprint"><code class="language-graddle">repositories {
    jcenter()
    maven {
        url &#39;https://raw.githubusercontent.com/mathieuancelin/json-lib-javaslang/master/repository/releases/&#39;
    }
}
</code></pre></dd>
  <dt>Sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-sbt">resolvers ++= Seq(
  &quot;jsonlib-repo&quot; at &quot;https://raw.githubusercontent.com/mathieuancelin/json-lib-javaslang/master/repository/releases&quot;,
  Resolver.jcenterRepo
)
</code></pre></dd>
</dl>
<p>Add the following dependency to your project </p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "fr.maif" %% "izanami-client" % "1.4.5-SNAPSHOT"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;fr.maif&lt;/groupId&gt;
  &lt;artifactId&gt;izanami-client_2.12&lt;/artifactId&gt;
  &lt;version&gt;1.4.5-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'fr.maif', name: 'izanami-client_2.12', version: '1.4.5-SNAPSHOT'
}</code></pre></dd></dl>
<p>The client can be used in java or scala. There is two distinct dsl. Be sure to import the correct one : </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">import izanami.*;
import izanami.javadsl.*;
</code></pre></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">import izanami._
import izanami.scaladsl._
</code></pre></dd>
</dl>
<p>Izanami client is built with </p>
<ul>
  <li><a href="https://www.scala-lang.org/">Scala</a>: As programming language</li>
  <li><a href="https://akka.io/docs/">Akka</a>: to handle global state, scheduler &hellip;</li>
  <li><a href="https://doc.akka.io/docs/akka-http/current/scala/http/index.html">Akka http</a>: for http request, sse &hellip;</li>
</ul>
<p>The scaladsl rely on :</p>
<ul>
  <li><a href="https://github.com/playframework/play-json">play json</a>: for json handling</li>
</ul>
<p>The javadsl rely on : </p>
<ul>
  <li><a href="http://www.vavr.io/">vavr</a>: For functional structures like future, either, option &hellip;</li>
  <li><a href="https://github.com/mathieuancelin/json-lib-javaslang">play json java</a>: For json handling</li>
</ul>
<h2><a href="#setup-the-izanami-client" name="setup-the-izanami-client" class="anchor"><span class="anchor-link"></span></a>Setup the Izanami client</h2>
<p>The first thing to do is to create a client. The client own the shared http client between config client, feature client and the experiment client.</p>
<p>You need to create a single client for all your application. </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">izanamiClient = IzanamiClient.client(
        system,
        ClientConfig.create(&quot;http://localhost:8089&quot;)
                .withClientId(&quot;xxxx&quot;)
                .withClientIdHeaderName(&quot;Another-Client-Id-Header&quot;)
                .withClientSecret(&quot;xxxx&quot;)
                .withClientSecretHeaderName(&quot;Another-Client-Secret-Header&quot;)
                .sseBackend()
                .withDispatcher(&quot;izanami-example.blocking-io-dispatcher&quot;)
                .withPageSize(50)
                .withZoneId(ZoneId.of(&quot;Europe/Paris&quot;))
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L55-L66" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">implicit val system = ActorSystem(
  &quot;izanami-client&quot;,
  ConfigFactory.parseString(&quot;&quot;&quot;
    izanami-example.blocking-io-dispatcher {
      type = Dispatcher
      executor = &quot;thread-pool-executor&quot;
      thread-pool-executor {
        fixed-pool-size = 32
      }
      throughput = 1
    }
  &quot;&quot;&quot;)
)

val client = IzanamiClient(
  ClientConfig(
    host = &quot;http://localhost:9000&quot;,
    clientId = Some(&quot;xxxx&quot;),
    clientIdHeaderName = &quot;Another-Client-Id-Header&quot;,
    clientSecret = Some(&quot;xxxx&quot;),
    clientSecretHeaderName = &quot;Another-Client-Id-Header&quot;,
    backend = SseBackend,
    pageSize = 50,
    zoneId = ZoneId.of(&quot;Europe/Paris&quot;),
    dispatcher = &quot;izanami-example.blocking-io-dispatcher&quot;
  )
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/ClientSpec.scala#L17-L43" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<table>
  <thead>
    <tr>
      <th>Field </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>clientId</code> </td>
      <td>The client id to access izanami APIs see <a href="../ui.html#manage-api-keys">Manage APIs keys</a> </td>
    </tr>
    <tr>
      <td><code>clientSecretIdName</code> </td>
      <td>A custom header for the client id </td>
    </tr>
    <tr>
      <td><code>clientSecret</code> </td>
      <td>The client secret to access izanami APIs see <a href="../ui.html#manage-api-keys">Manage APIs keys</a> </td>
    </tr>
    <tr>
      <td><code>clientSecretHeaderName</code> </td>
      <td>A custom header for the client secret </td>
    </tr>
    <tr>
      <td><code>sseBackend</code> </td>
      <td>Enable sse to get events from the server </td>
    </tr>
    <tr>
      <td><code>dispatcher</code> </td>
      <td>Reference a dispatcher to manage thread pool </td>
    </tr>
    <tr>
      <td><code>pageSize</code> </td>
      <td>Change the size of the pages when fetching from the server </td>
    </tr>
    <tr>
      <td><code>zoneId</code> </td>
      <td>Zone Id to handle date </td>
    </tr>
  </tbody>
</table>
<h2><a href="#configs-client" name="configs-client" class="anchor"><span class="anchor-link"></span></a>Configs client</h2>
<p>The config client is used to access the shared config in Izanami. To understand how configs work, just visit this </p>
<h3><a href="#setup-the-client" name="setup-the-client" class="anchor"><span class="anchor-link"></span></a>Setup the client</h3>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigClient configClient = izanamiClient.configClient(
        Strategies.fetchStrategy(),
        Configs.configs(
                Config.config(&quot;my:config&quot;, Json.obj(
                        Syntax.$(&quot;value&quot;, &quot;Fallback value&quot;)
                ))
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L180-L187" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configClient = client.configClient(
  strategy = FetchStrategy(),
  fallback = Configs(
    &quot;test2&quot; -&gt; Json.obj(&quot;value&quot; -&gt; 2)
  )
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/configs/FetchConfigClientSpec.scala#L37-L42" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>When you set up a client you have to choose a strategy : </p>
<table>
  <thead>
    <tr>
      <th>Strategy </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fetch </td>
      <td>Call izanami for each request </td>
    </tr>
    <tr>
      <td>Fetch with cache </td>
      <td>Keep response in cache </td>
    </tr>
    <tr>
      <td>Smart cache with polling </td>
      <td>Keep data in memory and poll izanami to refresh the cache asynchronously. </td>
    </tr>
    <tr>
      <td>Smart cache with sse </td>
      <td>Keep data in memory and refresh the cache with the events from the izanami server. </td>
    </tr>
  </tbody>
</table>
<h4><a href="#the-fetch-strategy" name="the-fetch-strategy" class="anchor"><span class="anchor-link"></span></a>The fetch strategy</h4>
<p>The fetch strategy will call izanami for each request. </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigClient configFetchStrategy = izanamiClient.configClient(
        Strategies.fetchStrategy(),
        Configs.configs(
                Config.config(&quot;my:config&quot;, Json.obj(
                        Syntax.$(&quot;value&quot;, &quot;Fallback value&quot;)
                ))
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L87-L94" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configClient = client.configClient(
  strategy = FetchStrategy(),
  fallback = Configs(
    &quot;test2&quot; -&gt; Json.obj(&quot;value&quot; -&gt; 2)
  )
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/configs/FetchConfigClientSpec.scala#L37-L42" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#the-fetch-with-cache-strategy" name="the-fetch-with-cache-strategy" class="anchor"><span class="anchor-link"></span></a>The fetch with cache strategy</h4>
<p>The fetch with cache will do dumb cache by http call. You have to provide a the max elements in cache and a TTL. </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Integer maxElementInCache = 100;
FiniteDuration ttl = FiniteDuration.create(20, TimeUnit.MINUTES);
ConfigClient fetchWithCacheStrategy = izanamiClient.configClient(
        Strategies.fetchWithCacheStrategy(maxElementInCache, ttl),
        Configs.configs(
                Config.config(&quot;my:config&quot;, Json.obj(
                        Syntax.$(&quot;value&quot;, &quot;Fallback value&quot;)
                ))
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L104-L113" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val strategy = IzanamiClient(
  ClientConfig(ctx.host)
).configClient(
  strategy = FetchWithCacheStrategy(maxElement = 2, duration = 1.second),
  fallback = Configs(
    &quot;test2&quot; -&gt; Json.obj(&quot;value&quot; -&gt; 2)
  )
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/configs/FetchWithCacheConfigClientSpec.scala#L28-L35" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#the-smart-cache-strategy" name="the-smart-cache-strategy" class="anchor"><span class="anchor-link"></span></a>The smart cache strategy</h4>
<p>When you choose the smart cache, you have to provide patterns : </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigClient configClient = izanamiClient.configClient(
        Strategies.smartCacheWithPollingStrategy(
                FiniteDuration.create(20, TimeUnit.SECONDS),
                &quot;my:configs:*&quot;, &quot;other:pattern&quot;
        ),
        Configs.configs(
                Config.config(&quot;my:config&quot;, Json.obj(
                        Syntax.$(&quot;value&quot;, &quot;Fallback value&quot;)
                ))
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L117-L127" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configClient = client.configClient(
  strategy = CacheWithPollingStrategy(
    patterns = Seq(&quot;*&quot;),
    pollingInterval = 3.second
  ),
  fallback = fallback
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/configs/SmartCacheConfigClientSpec.scala#L57-L63" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>The client will cache all the configs matching this patterns. </p>
<ul>
  <li>With a poll strategy, the client will request the server to get change so you have to set a delay.</li>
  <li>With a SSE strategy, the client will listen events from the server to refresh the cache.</li>
</ul><div class="callout warning "><div class="callout-title">Warning</div>
<p>There is no TTL using this strategy so you have to choose the right patterns to be sure that all datas fit in memory. </p></div>
<h4><a href="#handling-errors" name="handling-errors" class="anchor"><span class="anchor-link"></span></a>Handling errors</h4>
<p>An error handling strategy could be provided. You can choose between :</p>
<ul>
  <li><code>RecoverWithFallback</code>: If the call crash, the fallback is used</li>
  <li><code>Crash</code>: The call will finish on error if an error occured while evaluating the feature, config or experiment.</li>
</ul>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigClient configErrorStrategy = izanamiClient.configClient(
        Strategies.fetchStrategy(ErrorStrategies.crash())        
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L98-L100" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configClient = izanamiClient.configClient(
  strategy = FetchStrategy(Crash),
  fallback = Configs(
    &quot;test2&quot; -&gt; Json.obj(&quot;value&quot; -&gt; 2)
  )
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/configs/FetchConfigClientSpec.scala#L65-L70" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#client-usage" name="client-usage" class="anchor"><span class="anchor-link"></span></a>Client usage</h3>
<h4><a href="#get-configs-for-a-pattern" name="get-configs-for-a-pattern" class="anchor"><span class="anchor-link"></span></a>Get configs for a pattern</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Configs&gt; futureConfigs = configClient.configs(&quot;my:*&quot;);
futureConfigs.onSuccess( (Configs configs) -&gt; {
    JsValue config = configs.config(&quot;my:config&quot;);
    System.out.println(config.field(&quot;value&quot;).asString());
});</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L191-L195" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val configs: Future[Configs] = configClient.configs(&quot;*&quot;)
configs.onComplete {
  case Success(c) =&gt; println(c)
  case Failure(e) =&gt; e.printStackTrace()
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/configs/FetchConfigClientSpec.scala#L94-L98" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#get-one-config" name="get-one-config" class="anchor"><span class="anchor-link"></span></a>Get one config</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;JsValue&gt; futureConfig = configClient.config(&quot;my:config&quot;);
futureConfig.onSuccess( (JsValue config) -&gt; {
    System.out.println(config.field(&quot;value&quot;).asString());
});</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L199-L202" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureConfig: Future[JsValue] = izanamiClient.config(&quot;test&quot;)
futureConfig.onComplete {
  case Success(c) =&gt; println(c)
  case Failure(e) =&gt; e.printStackTrace()
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/configs/FetchConfigClientSpec.scala#L119-L123" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h2><a href="#features-client" name="features-client" class="anchor"><span class="anchor-link"></span></a>Features client</h2>
<p>To understand how features work, just visit this </p>
<h3><a href="#setup-the-client" name="setup-the-client" class="anchor"><span class="anchor-link"></span></a>Setup the client</h3>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">FeatureClient featureClient = izanamiClient.featureClient(
        Strategies.fetchStrategy(),
        Features.features(
                Features.feature(&quot;my:feature&quot;, false)
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L227-L232" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val featureClient = client.featureClient(
  strategy = FetchStrategy(),
  fallback = Features(
    DefaultFeature(&quot;test2&quot;, true)
  )
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L58-L63" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>When you set up a client you have to choose a strategy : </p>
<table>
  <thead>
    <tr>
      <th>Strategy </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fetch </td>
      <td>Call izanami for each request </td>
    </tr>
    <tr>
      <td>Fetch with cache </td>
      <td>Keep response in cache </td>
    </tr>
    <tr>
      <td>Smart cache with polling </td>
      <td>Keep data in memory and poll izanami to refresh the cache asynchronously. The features that need a context are not cached because it can needs a huge amount of memory </td>
    </tr>
    <tr>
      <td>Smart cache with sse </td>
      <td>Keep data in memory and refresh the cache with the events from the izanami server. The features that need a context are not cached because it can needs a huge amount of memory </td>
    </tr>
  </tbody>
</table>
<h4><a href="#the-fetch-strategy" name="the-fetch-strategy" class="anchor"><span class="anchor-link"></span></a>The fetch strategy</h4>
<p>The fetch strategy will call izanami for each request </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">FeatureClient featureClient = izanamiClient.featureClient(
        Strategies.fetchStrategy(),
        Features.features(
                Features.feature(&quot;my:feature&quot;, false)
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L227-L232" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val strategy = IzanamiClient(
  ClientConfig(host, pageSize = 2)
).featureClient(
  Strategies.fetchStrategy()
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L103-L107" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#the-fetch-with-cache-strategy" name="the-fetch-with-cache-strategy" class="anchor"><span class="anchor-link"></span></a>The fetch with cache strategy</h4>
<p>The fetch with cache will do dumb cache by http call. You have to provide a the max elements in cache and a TTL. </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Integer maxElementInCache = 100;
FiniteDuration ttl = FiniteDuration.create(20, TimeUnit.MINUTES);
FeatureClient featureClientWithCache = izanamiClient.featureClient(
        Strategies.fetchWithCacheStrategy(maxElementInCache, ttl),
        Features.features(
                Features.feature(&quot;my:feature&quot;, false)
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L242-L249" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val strategy = IzanamiClient(
  ClientConfig(ctx.host)
).featureClient(
  strategy = FetchWithCacheStrategy(maxElement = 2, duration = 1.second),
  fallback = Features(
    DefaultFeature(&quot;test2&quot;, true)
  )
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchWithCacheFeatureClientSpec.scala#L28-L35" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#the-smart-cache-strategy" name="the-smart-cache-strategy" class="anchor"><span class="anchor-link"></span></a>The smart cache strategy</h4>
<p>When you choose the smart cache, you have to provide patterns to select the keys that will be in cache: </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">FeatureClient featureClient = izanamiClient.featureClient(
        Strategies.smartCacheWithSseStrategy(
        &quot;my:features:*&quot;, &quot;other:pattern&quot;
        ),
        Features.features(
                Features.feature(&quot;my:feature&quot;, false)
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L131-L138" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val featureClient = client.featureClient(
  strategy = CacheWithPollingStrategy(
    patterns = Seq(&quot;*&quot;),
    pollingInterval = 3.second
  ),
  fallback = Features(fallback: _*)
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/SmartCacheFeatureClientSpec.scala#L61-L67" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>The client will cache all the configs matching this patterns. </p>
<ul>
  <li>With a poll strategy, the client will request the server to get change so you have to set a delay.</li>
  <li>With a SSE strategy, the client will listen events from the server to refresh the cache.</li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>The feature that need a context to be evaluated are not cached. The cache is used only for simple features or feature with release date. </p></div><div class="callout warning "><div class="callout-title">Warning</div>
<p>There is no TTL using this strategy so you have to choose the right patterns to be sure that all datas fit in memory. </p></div>
<h4><a href="#handling-errors" name="handling-errors" class="anchor"><span class="anchor-link"></span></a>Handling errors</h4>
<p>An error handling strategy could be provided. You can choose between :</p>
<ul>
  <li><code>RecoverWithFallback</code>: If the call crash, the fallback is used</li>
  <li><code>Crash</code>: The call will finish on error if an error occured while evaluating the feature, config or experiment.</li>
</ul>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">FeatureClient featureClientWithErrorHandling = izanamiClient.featureClient(
        Strategies.fetchStrategy(ErrorStrategies.crash())
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L236-L238" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val featureClient = izanamiClient.featureClient(
  FetchStrategy(Crash)
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L37-L39" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#client-usage" name="client-usage" class="anchor"><span class="anchor-link"></span></a>Client usage</h3>
<h4><a href="#list-features" name="list-features" class="anchor"><span class="anchor-link"></span></a>List features</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Features&gt; futureFeatures = featureClient.features(&quot;my:feature:*&quot;);

futureFeatures.onSuccess(features -&gt; {
    boolean active = features.isActive(&quot;my:feature:test&quot;);
    if (active) {
        System.out.println(&quot;Feature my:feature:test is active&quot;);
    } else {
        System.out.println(&quot;Feature my:feature:test is active&quot;);
    }
    JsObject tree = features.tree();
    System.out.println(&quot;Tree is &quot; + Json.prettyPrint(tree));
});</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L321-L332" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureFeatures: Future[Features] = featureClient.features(&quot;*&quot;)
futureFeatures.onComplete {
  case Success(features) =&gt;
    val active: Boolean = features.isActive(&quot;test&quot;)
    if (active)
      println(s&quot;Feature test is active&quot;)
    else
      println(s&quot;Feature test is not active&quot;)

    val tree: JsObject = features.tree()
    println(s&quot;All features: ${Json.prettyPrint(tree)}&quot;)

  case Failure(e) =&gt;
    e.printStackTrace()
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L73-L87" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#check-feature" name="check-feature" class="anchor"><span class="anchor-link"></span></a>Check feature</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Boolean&gt; futureCheck = featureClient.checkFeature(&quot;my:feature&quot;);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L253" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureCheck: Future[Boolean] = featureClient.checkFeature(&quot;test&quot;)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L146" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>If the feature needs a context to be evaluated: </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Boolean&gt; futureCheckContext = featureClient.checkFeature(&quot;my:feature&quot;, Json.obj(
        Syntax.$(&quot;context&quot;, true)
));</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L257-L259" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val context                           = Json.obj(&quot;context&quot; -&gt; true)
val checkWithContext: Future[Boolean] = featureClient.checkFeature(&quot;test&quot;, context)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L158-L159" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#conditional-code-on-feature" name="conditional-code-on-feature" class="anchor"><span class="anchor-link"></span></a>Conditional code on feature</h4>
<p>This execute a code and return a value if a feature is active: </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;String&gt; conditonal = featureClient.featureOrElse(&quot;my:feature&quot;,
        () -&gt; &quot;Feature is active&quot;,
        () -&gt; &quot;Feature is not active&quot;
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L263-L266" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val conditonal: Future[String] = featureClient.featureOrElse(&quot;test&quot;) {
  &quot;Feature is active&quot;
} {
  &quot;Feature is not active&quot;
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L163-L167" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>Or with a context </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;String&gt; conditonalContext = featureClient.featureOrElse(
        &quot;my:feature&quot;,
        Json.obj(Syntax.$(&quot;context&quot;, true)),
        () -&gt; &quot;Feature is active&quot;,
        () -&gt; &quot;Feature is not active&quot;
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L270-L275" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val conditonalWithContext: Future[String] = featureClient.featureOrElse(&quot;test&quot;, context) {
  &quot;Feature is active&quot;
} {
  &quot;Feature is not active&quot;
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/features/FetchFeatureClientSpec.scala#L171-L175" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h2><a href="#experiments-client" name="experiments-client" class="anchor"><span class="anchor-link"></span></a>Experiments client</h2>
<p>To understand how experiments work, just visit this  </p>
<h3><a href="#setup-the-client" name="setup-the-client" class="anchor"><span class="anchor-link"></span></a>Setup the client</h3>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ExperimentsClient experimentsClient = izanamiClient.experimentClient(Strategies.fetchStrategy());</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L344" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val experimentClient = IzanamiClient(ClientConfig(host))
  .experimentClient(Strategies.fetchStrategy())</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/experiments/FetchExperimentsClientStrategySpec.scala#L29-L30" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>For experiments, there is only two strategies available : fetch or dev.</p>
<h3><a href="#variants" name="variants" class="anchor"><span class="anchor-link"></span></a>Variants</h3>
<h4><a href="#get-a-variant-for-a-client" name="get-a-variant-for-a-client" class="anchor"><span class="anchor-link"></span></a>Get a variant for a client</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Option&lt;Variant&gt;&gt; futureVariant = experimentsClient.getVariantFor(&quot;my:experiment&quot;, &quot;clientId&quot;);
futureVariant.onSuccess(mayBeVariant -&gt;
        Match(mayBeVariant).of(
                Case($Some($()), exist -&gt; {
                    String phrase = &quot;Variant is &quot; + exist;
                    System.out.println(phrase);
                    return phrase;
                }),
                Case($None(), __ -&gt; {
                    String phrase = &quot;Variant not found&quot;;
                    System.out.println(phrase);
                    return phrase;
                })
        )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L471-L485" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val mayBeFutureVariant: Future[Option[Variant]] = experimentClient.getVariantFor(&quot;test&quot;, &quot;client1&quot;)
mayBeFutureVariant.onComplete {
  case Success(mayBeVariant) =&gt; println(mayBeVariant)
  case Failure(e)            =&gt; e.printStackTrace()
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/experiments/FetchExperimentsClientStrategySpec.scala#L64-L68" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#mark-variant-displayed" name="mark-variant-displayed" class="anchor"><span class="anchor-link"></span></a>Mark variant displayed</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;ExperimentVariantDisplayed&gt; futureDisplayed = experimentsClient.markVariantDisplayed(&quot;my:experiment&quot;, &quot;clientId&quot;);
futureDisplayed.onSuccess(event -&gt;
        System.out.println(event)
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L492-L495" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureDisplayed: Future[ExperimentVariantDisplayed] =
  experimentClient.markVariantDisplayed(&quot;test&quot;, &quot;client1&quot;)
futureDisplayed.onComplete {
  case Success(event) =&gt; println(event)
  case Failure(e)     =&gt; e.printStackTrace()
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/experiments/FetchExperimentsClientStrategySpec.scala#L87-L92" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#mark-variant-won" name="mark-variant-won" class="anchor"><span class="anchor-link"></span></a>Mark variant won</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;ExperimentVariantWon&gt; futureWon = experimentsClient.markVariantWon(&quot;my:experiment&quot;, &quot;clientId&quot;);
futureWon.onSuccess(event -&gt;
        System.out.println(event)
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L503-L506" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureWon: Future[ExperimentVariantWon] = experimentClient.markVariantWon(&quot;test&quot;, &quot;client1&quot;)
futureWon.onComplete {
  case Success(event) =&gt; println(event)
  case Failure(e)     =&gt; e.printStackTrace()
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/experiments/FetchExperimentsClientStrategySpec.scala#L95-L99" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#work-with-experiment" name="work-with-experiment" class="anchor"><span class="anchor-link"></span></a>Work with experiment</h3>
<h4><a href="#get-the-experiment" name="get-the-experiment" class="anchor"><span class="anchor-link"></span></a>Get the experiment</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;Option&lt;ExperimentClient&gt;&gt; futureExperiment = experimentsClient.experiment(&quot;my:experiment&quot;);
futureExperiment.onSuccess(mayBeExperiment -&gt;
    Match(mayBeExperiment).of(
            Case($Some($()), exist -&gt; {
                String phrase = &quot;Experiment is &quot; + exist;
                System.out.println(phrase);
                return phrase;
            }),
            Case($None(), __ -&gt; {
                String phrase = &quot;Experiment not found&quot;;
                System.out.println(phrase);
                return phrase;
            })
    )
);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L444-L458" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futureExperiment: Future[Option[ExperimentClient]] = experimentClient.experiment(&quot;test&quot;)
futureExperiment.onComplete {
  case Success(Some(exp)) =&gt; println(s&quot;Experiment is $exp&quot;)
  case Success(None)      =&gt; println(&quot;Experiment not Found&quot;)
  case Failure(e)         =&gt; e.printStackTrace()
}</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/experiments/FetchExperimentsClientStrategySpec.scala#L53-L58" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>Once you get the experiment, you can get a variant for a client, mark variant displayed or mark variant won : </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ExperimentClient experiment = mayExperiment.get();
Future&lt;Option&lt;Variant&gt;&gt; clientId = experiment.getVariantFor(&quot;clientId&quot;);
Future&lt;ExperimentVariantDisplayed&gt; displayed = experiment.markVariantDisplayed(&quot;clientId&quot;);
Future&lt;ExperimentVariantWon&gt; won = experiment.markVariantWon(&quot;clientId&quot;);</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L464-L467" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val experiment: ExperimentClient                  = mayBeExperiment.get
val futureVariant: Future[Option[Variant]]        = experiment.getVariantFor(&quot;client1&quot;)
val displayed: Future[ExperimentVariantDisplayed] = experiment.markVariantDisplayed(&quot;client1&quot;)
val won: Future[ExperimentVariantWon]             = experiment.markVariantWon(&quot;client1&quot;)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/experiments/FetchExperimentsClientStrategySpec.scala#L77-L80" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#experiment-tree" name="experiment-tree" class="anchor"><span class="anchor-link"></span></a>Experiment tree</h3>
<p>You can get the experiments tree with associated variant for a client : </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Future&lt;JsValue&gt; futureTree = experimentsClient.tree(&quot;*&quot;, &quot;clientId&quot;);
futureTree.onSuccess(tree -&gt; {
    assertThat(tree).isEqualTo(
            Json.obj(
                    Syntax.$(&quot;my&quot;, Json.obj(
                            Syntax.$(&quot;experiment&quot;, Json.obj(
                                    Syntax.$(&quot;variant&quot;, &quot;A&quot;)
                            ))
                    ))
            )
    );
});</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L513-L524" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val experimentsTree = client.tree(&quot;*&quot;, &quot;client1&quot;).futureValue
experimentsTree must be(
  Json.obj(
    &quot;izanami&quot; -&gt; Json.obj(
      &quot;ab&quot; -&gt; Json.obj(
        &quot;test&quot; -&gt; Json.obj(
          &quot;variant&quot; -&gt; &quot;A&quot;
        )
      )
    )
  )
)
val experimentsTree = client.tree(&quot;*&quot;, &quot;client1&quot;).futureValue
experimentsTree must be(
  Json.obj()
)</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/experiments/FetchExperimentsClientStrategySpec.scala#L115-L149" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h2><a href="#exposing-izanami-with-a-proxy" name="exposing-izanami-with-a-proxy" class="anchor"><span class="anchor-link"></span></a>Exposing izanami with a Proxy</h2>
<p>When you have to use Izanami from the client side, you can&rsquo;t call Izanami directly from the browser because it means the API keys are exposed to anyone. </p>
<p>The best solution is to use your backend as a proxy. You can do this with the jvm client. </p>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigClient configClient = izanamiClient.configClient(
        Strategies.dev(),
        Configs.configs(
                Config.config(&quot;configs:test&quot;, Json.obj(
                        Syntax.$(&quot;value&quot;, 2)
                ))
        )
);
FeatureClient featureClient = izanamiClient.featureClient(
        Strategies.dev(),
        Features.features(
                Features.feature(&quot;features:test1&quot;, true)
        )
);
ExperimentsClient experimentsClient = izanamiClient.experimentClient(
        Strategies.dev(),
        Experiments.create(
                ExperimentFallback.create(
                        &quot;experiments:id&quot;,
                        &quot;Experiment&quot;,
                        &quot;An Experiment&quot;,
                        true,
                        Variant.create(&quot;A&quot;, &quot;Variant A&quot;, &quot;Variant A&quot;)
                )));

Proxy proxy = izanamiClient.proxy()
        .withConfigClient(configClient)
        .withConfigPattern(&quot;configs:*&quot;)
        .withFeatureClient(featureClient)
        .withFeaturePattern(&quot;features:*&quot;)
        .withExperimentsClient(experimentsClient)
        .withExperimentPattern(&quot;experiments:*&quot;);

Future&lt;Tuple2&lt;Integer, JsValue&gt;&gt; fJsonResponse = proxy.statusAndJsonResponse();
fJsonResponse.onSuccess(t -&gt;
        System.out.println(&quot;Code = &quot;+t._1+&quot;, json body = &quot;+t._2)
);

//Or with string response and additional infos :
Future&lt;Tuple2&lt;Integer, String&gt;&gt; fStringResponse = proxy.statusAndStringResponse(Json.obj().with(&quot;id&quot;, &quot;ragnard.lodbrock@gmail.com&quot;), &quot;ragnard.lodbrock@gmail.com&quot;);
fStringResponse.onSuccess(t -&gt;
        System.out.println(&quot;Code = &quot;+t._1+&quot;, string body = &quot;+t._2)
);
// Experiment proxy

Future&lt;Tuple2&lt;Integer, JsValue&gt;&gt; markVariantDisplayed = proxy.markVariantDisplayed(&quot;experiments:id&quot;, &quot;ragnars.lodbrock@gmail.com&quot;);
Future&lt;Tuple2&lt;Integer, JsValue&gt;&gt; markVariantWon = proxy.markVariantWon(&quot;experiments:id&quot;, &quot;ragnars.lodbrock@gmail.com&quot;);
</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/java/izanami/javadsl/IzanamiTest.java#L531-L578" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val client = IzanamiClient(
  ClientConfig(&quot;&quot;)
)

val featureClient: FeatureClient = client.featureClient(
  strategy = Strategies.dev(),
  fallback = Features(
    DefaultFeature(&quot;features:test1&quot;, true)
  )
)

val configClient: ConfigClient = client.configClient(
  Strategies.dev(),
  fallback = Configs(
    &quot;configs:test&quot; -&gt; Json.obj(&quot;value&quot; -&gt; 2)
  )
)

val experimentsClient: ExperimentsClient = client.experimentClient(
  strategy = Strategies.dev(),
  fallback = Experiments(
    ExperimentFallback(&quot;experiments:id&quot;,
                       &quot;Experiment&quot;,
                       &quot;An experiment&quot;,
                       true,
                       Variant(&quot;A&quot;, &quot;Variant A&quot;, &quot;Variant A&quot;))
  )
)

val proxy: Proxy = client
  .proxy()
  .withConfigClient(configClient)
  .withConfigPattern(&quot;configs:*&quot;)
  .withFeatureClient(featureClient)
  .withFeaturePattern(&quot;features:*&quot;)
  .withExperimentsClient(experimentsClient)
  .withExperimentPattern(&quot;experiments:*&quot;)

val fResponseJson: Future[(Int, JsValue)] = proxy.statusAndJsonResponse()
fResponseJson.onComplete {
  case Success((status, responseBody)) =&gt;
    println(s&quot;Izanami respond with status $status and json body $responseBody&quot;)
  case _ =&gt; println(&quot;Oups something wrong happened&quot;)
}

//Or for a string response and additional infos
val fResponseString: Future[(Int, String)] = proxy.statusAndStringResponse(
  context = Some(Json.obj(&quot;user&quot; -&gt; &quot;ragnard.lodbrock@gmail.com&quot;)),
  userId = Some(&quot;ragnard.lodbrock@gmail.com&quot;)
)
fResponseString.onComplete {
  case Success((status, responseBody)) =&gt;
    println(s&quot;Izanami respond with status $status and string body $responseBody&quot;)
  case _ =&gt; println(&quot;Oups something wrong happened&quot;)
}

// Experiment proxy

val fDisplayed: Future[(Int, JsValue)] =
  proxy.markVariantDisplayed(&quot;experiments:id&quot;, &quot;ragnard.lodbrock@gmail.com&quot;)
val fWon: Future[(Int, JsValue)] = proxy.markVariantWon(&quot;experiments:id&quot;, &quot;ragnard.lodbrock@gmail.com&quot;)
</code></pre><a href="https://github.com/MAIF/izanami/tree/master/izanami-clients/jvm/src/test/scala/izanami/proxy/ProxySpec.scala#L25-L86" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/MAIF/izanami/tree/master/izanami-documentation/src/main/paradox/clients/jvm.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../clients/react.html">React client</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../clients/jvm.html#java-scala" class="header">Java &amp; Scala</a>
  <ul>
    <li><a href="../clients/jvm.html#setup-the-izanami-client" class="header">Setup the Izanami client</a></li>
    <li><a href="../clients/jvm.html#configs-client" class="header">Configs client</a></li>
    <li><a href="../clients/jvm.html#features-client" class="header">Features client</a></li>
    <li><a href="../clients/jvm.html#experiments-client" class="header">Experiments client</a></li>
    <li><a href="../clients/jvm.html#exposing-izanami-with-a-proxy" class="header">Exposing izanami with a Proxy</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2019</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112498312-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-112498312-1');
</script>
</html>




